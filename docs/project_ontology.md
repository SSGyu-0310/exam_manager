# 프로젝트 온톨로지 및 워크플로우 정의서

## 2. 도메인 온톨로지 (Domain Ontology)

### 2.1 핵심 개념 사전 (Domain Dictionary)

| 개념명 (한/영) | 정의 | 필수 속성 | 생성/수정 주체 |
|---|---|---|---|
| **사용자 (User)** | 시스템을 이용하는 주체 (학생 또는 관리자) | 이메일, 비밀번호(Hash), 관리자여부, 가입일, 고유ID | 사용자 / 관리자 |
| **블록 (Block)** | 학습의 가장 상위 분류 단위 (과목/모듈) | 이름, 설명, 순서, 공개여부, 사용자ID(소유자) | 관리자 / 사용자 |
| **강의 (Lecture)** | 블록 내의 하위 학습 단위 | 제목, 교수명, 순서, 설명, 소속블록ID | 관리자 / 사용자 |
| **기출 시험지 (PreviousExam)** | 문제의 원천이 되는 시험지 원본 | 제목(년도/과목), 시험일자, 원본파일경로, 분류상태, 소유자ID | 관리자 |
| **문제 (Question)** | 학습 및 평가의 최소 단위 | 본문, 정답, 해설, 유형(객관식/주관식), 난이도, 소속시험ID | 관리자 / AI(분류) |
| **자료/교재 (LectureMaterial)** | 강의와 연동되는 학습 자료 (PDF 등) | 파일경로, 업로드일시, 인덱싱상태, 소속강의ID | 관리자 |
| **풀이 세션 (PracticeSession)** | 사용자가 문제를 푸는 학습 행위의 단위 | 시작시간, 종료시간, 모드(연습/실전), 대상범위(강의목록), 사용자ID | 사용자 |
| **풀이 기록 (PracticeAnswer)** | 세션 내 개별 문제에 대한 응답 기록 | 사용자답안, 정답여부, 소요시간, 문제ID, 세션ID | 사용자 |
| **오답/노트 (UserNote)** | 특정 문제에 대한 사용자의 개인 메모 | 내용, 작성일시, 문제ID, 사용자ID | 사용자 |
| **분류 작업 (ClassificationJob)** | AI를 이용한 대량 문제 분류 비동기 작업 | 상태(대기/진행/완료), 총문제수, 성공수, 결과JSON, 작업ID | 시스템 / AI |

### 2.2 관계도 (Entity Relationship)

- **User** 1 : N **Block** (사용자는 개인 블록을 가질 수 있음)
- **Block** 1 : N **Lecture** (블록은 여러 강의로 구성됨)
- **Lecture** 1 : N **Question** (강의는 여러 문제와 매핑됨 / 분류됨)
- **Lecture** 1 : N **LectureMaterial** (강의는 여러 교재 자료를 가짐)
- **PreviousExam** 1 : N **Question** (시험지는 여러 문제를 포함함 - 원본 출처)
- **Question** 1 : N **Choice** (객관식 문제는 여러 선택지를 가짐)
- **User** 1 : N **PracticeSession** (사용자는 여러 학습 세션을 진행함)
- **PracticeSession** 1 : N **PracticeAnswer** (세션은 여러 풀이 기록을 포함함)
- **Question** 1 : N **PracticeAnswer** (하나의 문제는 여러 번 풀릴 수 있음)
- **Question** 1 : 1 **UserNote** (사용자는 문제당 하나의 노트를 작성 - *현재 모델상 N일 수 있으나 논리적 1:1 권장*)
- **ClassificationJob** N : M **Question** (작업은 다수의 문제를 처리함 - 메타데이터로 연결)

### 2.3 이벤트/행동 (Events & Commands)

| 구분 | 이름 | 트리거 | 입력 | 출력 | 로그/저장 |
|---|---|---|---|---|---|
| **Cmd** | **시험지 업로드/파싱** | 관리자 업로드 클릭 | PDF 파일 | 문제/선지 데이터 임시저장 | PreviousExam 생성, Question 생성 |
| **Cmd** | **AI 분류 요청** | 관리자 '분류 시작' 클릭 | 대상 문제 목록, 범위 설정 | Job ID | ClassificationJob 생성 (Pending) |
| **Evt** | **분류 완료** | 백그라운드 작업 종료 | AI 모델 예측값 | 분류 결과 JSON, 상태 변경 | ClassificationJob 상태 업데이트 (Completed) |
| **Cmd** | **풀이 세션 시작** | 사용자 '학습 시작' 클릭 | 학습 모드, 대상 블록/강의 | 문제 목록, 세션 ID | PracticeSession 생성 |
| **Cmd** | **정답 제출** | 사용자 문제 풀이 중 Next | 선택한 답안 | 정오답 여부, 해설(연습모드 시) | PracticeAnswer 저장 |
| **Cmd** | **노트 작성** | 사용자 풀이/결과 화면 | 메모 텍스트 | 저장 확인 | UserNote 생성/수정 |

---

## 3. 핵심 유저 여정 (Key User Journeys)

### 3.1 학습(풀이) Journey
*목적: 사용자가 원하는 범위의 문제를 풀고 실력을 점검한다.*

- **진입점**: 메인 대시보드 > "학습하기" 또는 특정 블록/강의 상세 > "문제 풀기"
- **단계**:
    1. **학습 설정**: 범위(전체/블록/강의), 모드(연습/시험), 문항 수 설정
    2. **문제 풀이 화면**: 문제/선지 표시, 답안 선택, "정답 확인"(연습모드), "다음 문제"
    3. **세션 종료**: 모든 문제 풀이 후 또는 중단 요청
    4. **결과 리포트**: 점수, 소요 시간, 정오답 목록 표시
    5. **오답 리뷰 진입**: 틀린 문제 바로 다시보기 버튼
- **KPI**: 세션 완료율, 세션 당 평균 소요 시간

### 3.2 복습/오답 Journey
*목적: 틀린 문제나 취약한 부분을 집중적으로 보완한다.*

- **진입점**: 메인 대시보드 > "오답 노트" 또는 결과 리포트 > "오답 다시 풀기"
- **단계**:
    1. **오답 목록 조회**: 최근 틀린 문제, 자주 틀리는 문제 필터링
    2. **문제 상세/해설**: 문제와 내 답안, 정답 및 해설, 관련 교재 청크(RAG 결과) 확인
    3. **메모/태깅**: "이해 안 됨", "암기 필요" 등 태그 또는 메모 작성
    4. **강의 이동**: 해당 문제가 속한 강의 자료(PDF 페이지)로 바로 이동하여 개념 학습
- **KPI**: 오답 재풀이 성공률, 문제별 체류 시간(해설 정독 여부)

### 3.3 콘텐츠/세트 관리 Journey (관리자/Admin)
*목적: 시험 데이터를 효율적으로 시스템에 등록하고 분류한다.*

- **진입점**: Admin 메뉴 > "문제 관리" 또는 "기출 업로드"
- **단계**:
    1. **자료 등록**: PDF 업로드 및 OCR/파싱 (자동 문제 추출)
    2. **검수 및 수정**: 파싱된 문제/선지 텍스트 오타 수정, 이미지 크롭 확인
    3. **분류 작업**: AI 분류 실행 또는 수동으로 강의 태그 지정
    4. **공개 처리**: 검수 완료된 블록/강의를 사용자에게 공개(Publish)
- **KPI**: 시간당 문제 등록 수, AI 분류 정확도(수동 수정 비율 역수)

---

## 4. IA (Information Architecture) 초안

1.  **대시보드 (Home)**
    *   최근 학습 현황, 주간 목표 달성률, 바로 이어서 풀기
    *   *이유: 사용자가 앱을 켜자마자 자신의 상태를 확인하고 학습 흐름을 이어가기 위함.*
2.  **학습하기 (Learn)**
    *   블록(과목) > 강의 목차 탐색
    *   커스텀 퀴즈 생성 (범위 설정)
    *   *이유: 체계적인 커리큘럼 기반 학습과 유연한 문제 풀이를 모두 지원.*
3.  **복습/기록 (Review)**
    *   풀이 이력(Sessions), 오답 노트, 북마크한 문제
    *   *이유: 과거의 기록을 통해 약점을 파악하는 별도의 분석 공간 제공.*
4.  **관리/설정 (Admin/Settings)**
    *   (관리자용) 기출 관리, 분류 관리, 교재 업로드
    *   프로필 설정, 비밀번호 변경
    *   *이유: 일반 사용자와 관리자의 기능을 명확히 분리하되, 접근성을 위해 메뉴 배치.*

**공통 기능**:
- **Global Search**: 문제 키워드, 강의명 검색 (상단 고정)

---

## 5. 기능 정리 및 개선 제안

### 중복/혼란 요소
- **`manage.py` vs `api_manage.py`**:
    - *문제*: 뷰 렌더링 코드와 API 로직이 혼재되어 있거나 파일명이 비슷해 역할 구분이 모호함.
    - *권고*: `manage.py`는 `routes/views/admin.py`로, `api_manage.py`는 `routes/api/admin_api.py` 등으로 명확히 분리하거나 Blueprints 구조를 기능별(Curriculum, Exam, User)로 재편하는 것 추천.
- **이미지 크롭/파싱 로직 (`crop.py`)**:
    - *문제*: 라우트 폴더 내에 무거운 로직 파일이 존재.
    - *권고*: `app/services/pdf_processor.py` 등으로 서비스 계층으로 이동.

### 누락된 필수 기능 (제안)
- **통계/분석 대시보드**: 단순히 푼 기록 외에 "취약 과목(블록) 분석" 시각화 필요.
- **포인트/게이미피케이션**: "레벨"이나 "연속 학습일" 등의 동기 부여 요소(User 모델에 속성 추가 필요).

---

## 6. 다음 액션 체크리스트

### 1주 안에 할 일 (우선순위)
1.  [ ] **데이터 모델 확정**: `models.py`의 `TODO` 항목(User ID nullable 제거 등) 정리 및 마이그레이션.
2.  [ ] **PDF 파싱 안정화**: `crop.py` 테스트 및 오인식률 개선.
3.  [ ] **AI 분류 파이프라인 연동**: `ai.py`의 분류 결과를 실제로 DB `Question.lecture_id`에 반영하는 UI/Flow 완성.
4.  [ ] **학습 모드 UI 개선**: 모바일 대응 등 반응형 뷰 점검 (학습 접근성 증대).
5.  [ ] **기본 대시보드 구현**: 로그인 직후 빈 화면 대신 "최근 세션" 바로가기 제공.

### 1달 안에 할 일
1.  [ ] **검색 엔진 고도화**: 단순 Like 검색에서 `EvaluationLabel` 등을 활용한 의미 검색(Hybrid Search) 도입 고려.
2.  [ ] **오답 노트 고도화**: 단순히 모아보는 것을 넘어, "유사 문제 추천" 기능 기획.
3.  [ ] **공용 템플릿 마켓**: `PublicCurriculumTemplate` 활용하여 유저 간 커리큘럼 공유 활성화.

### 기술 부채/리스크
1.  **대용량 트래픽 시 AI Latency**: 동기식 처리 구간 확인 및 완전 비동기(Celery/Redis Queue) 전환 검토.
2.  **이미지 스토리지**: 로컬 파일 시스템(`static/`) 사용 중 -> S3 등 Object Storage로 이관 필요 (확장성).
3.  **인증 보안**: Session 기반 vs JWT 명확화 및 Refresh Token 전략 수립 (앱 확장 대비).

---

## 7. 핵심 질문 (결정을 위한 질문)

1.  **개인화 범위**: "공용 기출문제(PreviousExam)"를 사용자가 풀었을 때, 오답 노트나 태깅 정보는 **개인별로 완전히 별도 저장**됩니까? (현재 모델은 `UserNote`가 분리되어 있어 보임, `Question` 자체의 메타데이터 수정 권한은 관리자에게만 있나요?)
2.  **데이터 격리 정책**: 사용자가 생성한 커리큘럼(블록/강의)은 기본적으로 **비공개(Private)** 인가요? (공유하려면 명시적으로 `PublicTemplate`으로 발행해야 하는 방식인지?)
3.  **AI 개입 시점**: 문제 분류(Question -> Lecture)는 **관리자가 업로드 시점에만** 수행하나요, 아니면 사용자가 풀면서 "이 문제는 이 강의 내용 같아요"라고 **피드백**을 줄 수 있나요?
4.  **과금 모델**: 향후 유료화 계획이 있다면, **기출문제 열람**이 유료인가요, 아니면 **AI 해설/분석 기능**이 유료인가요? (이에 따라 데이터 접근 제어 설계가 달라짐)
5.  **모바일 앱 여부**: 현재 웹 기반인데, 추후 **네이티브 앱** 출시 계획이 있나요? (API 우선 설계 원칙 준수 여부 결정)
