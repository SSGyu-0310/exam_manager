#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
NEXT_DIR="$ROOT_DIR/next_app"

if [[ ! -f "$NEXT_DIR/.env.local" ]]; then
  cat > "$NEXT_DIR/.env.local" <<'EOF'
FLASK_BASE_URL=http://127.0.0.1:5000
NEXT_PUBLIC_SITE_URL=http://localhost:4000
NEXT_PUBLIC_APP_URL=http://localhost:4000
EOF
  echo "[dev-frontend] created next_app/.env.local"
fi

if [[ ! -d "$NEXT_DIR/node_modules" ]]; then
  echo "[dev-frontend] node_modules not found. Run: cd next_app && npm install" >&2
  exit 1
fi

cd "$NEXT_DIR"
exec npm run dev
